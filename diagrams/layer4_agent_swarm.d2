colorMode pastel
styleMode shadow
typeface clean
title Layer 4 Agent Swarm
direction down

AgentSwarm[label: "Agent Swarm", color: "red"]
{
  ContextManager[label: "Context Window\n(Token Budgeting)"]
  CoderAgent[label: "Coder Agent\n(Jinja2 templates; script gen)"]
  Sandbox[label: "Secure Sandbox"]
  DecisionGate[label: "Tests Pass?", color: "yellow"]
  HumanGate[label: "HITL Approval?", color: "yellow"]
}

ContextManager>CoderAgent: ProvideContext
CoderAgent>Sandbox: SubmitCode
Sandbox>DecisionGate: TestResult
DecisionGate>CoderAgent: FixLoop[color: red]
DecisionGate>HumanGate: Success[color: green]

Input[label: "From RAG Engine", shape: oval, color: "green"]
Output[label: "To Runtime", shape: oval, color: "blue"]
Observability[label: "To Observability", shape: oval, color: "gray"]

Input>ContextManager: QualifiedContext
HumanGate>Output: Deploy
ContextManager>Observability: TokenUsage

legend
{
  [connection: >, label: request flow]
  [shape: rectangle, color: yellow, label: decision]
  [shape: rectangle, color: red, label: sandbox]
}
