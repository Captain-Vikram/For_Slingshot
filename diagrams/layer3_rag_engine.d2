colorMode pastel
styleMode shadow
typeface clean
title Layer 3 RAG Knowledge Base
direction down

RAGEngine[label: "RAG Knowledge Base", color: "green"]
{
  Sources[label: "Sources"]
  {
    Manuals[label: "Manuals"]
    Logs[label: "Logs"]
    WebSearch[label: "Live Web Search"]
    InternetScrape[label: "Internet Scrape\n(Web examples)"]
  }
  Processing[label: "Processing"]
  {
    Chunker[label: "Chunker\n(Basic chunking)"]
    Embedder[label: "Embedding Model"]
  }
  VectorStore[label: "ChromaDB\n(local)"]
  Retrieval[label: "Retrieval Logic"]
  {
    HybridSearch[label: "Hybrid Search"]
    Reranker[label: "Cross Encoder Reranker"]
  }
}

Manuals>Chunker
Logs>Chunker
WebSearch>Chunker
Chunker>Embedder: Chunks
Embedder>VectorStore: Vectors
VectorStore>HybridSearch: Retrieve
HybridSearch>Reranker: Reorder
Reranker>Output: QualifiedContext

Input[label: "From Data Ops", shape: oval, color: "purple"]
Output[label: "To Agent Swarm", shape: oval, color: "red"]
Input>Sources: Metadata
Reranker>Output: QualifiedContext

legend
{
  [connection: >, label: request flow]
  [shape: rectangle, color: green, label: vector storage]
  [shape: rectangle, color: yellow, label: quality gate]
}
